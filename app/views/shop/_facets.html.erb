<div class="panel-group" id="facets">

<% if items.facet(:properties) and items.facet(:properties).rows.count > 0 %>
	
	<% Item.dynamic_facets(items.facet(:properties)).each do |prop_name,val_hash| %>
		<% if !val_hash.values.include?(items.total) %>
	
			<div class="panel panel-default">
				
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#<%= prop_name.gsub(/[^\w-]/, '') %>Filter">
						</span><%= prop_name %></a>
					</h4>
				</div>
					<div id="<%= prop_name.gsub(/[^\w-]/, '') %>Filter" class="panel-collapse collapse">
						
						<ul class="list-group">
							
							<% val_hash.each do |val_name,count| %>
								
								<% if val_name %>
									
									<li class="list-group-item">
										<% if params[:properties].blank? || !params[:properties].include?("#{prop_name}|#{val_name}") %>
										<% count > (params[:page].to_i - 1) * items.results.per_page ? page_num = params[:page] : page_num = 1 %>
										<%= link_to val_name, params.merge(:page => page_num, :properties => params[:properties].to_a + ["#{prop_name}|#{val_name}"]) %> (<%= count%>)
							 	 	 <% else %>
								 	<strong><%= val_name %></strong> (<%= link_to "remove", properties: params[:properties].to_a - ["#{prop_name}|#{val_name}"] %>)
								 	<% end %>
									</li>
									<% end %>
							<% end %>
						</ul>
					</div>
			</div>
		<% end %>
	
	<% end %>
	
<% end %>

</div>